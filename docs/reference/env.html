<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Create a new environment — env • rlang</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<meta property="og:title" content="Create a new environment — env" />

<meta property="og:description" content="These functions create new environments.
env() always creates a child of the current environment.
child_env() lets you specify a parent (see section on
inheritance).
new_environment() creates a child of the empty environment. It
is useful e.g. for using environments as containers of data
rather than as part of a scope hierarchy.
" />
<meta name="twitter:card" content="summary" />
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">rlang</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../reference/lifecycle.html">Lifecycle</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-lib/rlang">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create a new environment</h1>
    </div>

    
    <p>These functions create new environments.</p><ul>
<li><p><code>env()</code> always creates a child of the current environment.</p></li>
<li><p><code>child_env()</code> lets you specify a parent (see section on
inheritance).</p></li>
<li><p><code>new_environment()</code> creates a child of the empty environment. It
is useful e.g. for using environments as containers of data
rather than as part of a scope hierarchy.</p></li>
</ul>
    

    <pre class="usage"><span class='fu'>env</span>(<span class='no'>...</span>)

<span class='fu'>child_env</span>(<span class='no'>.parent</span>, <span class='no'>...</span>)

<span class='fu'>new_environment</span>(<span class='kw'>data</span> <span class='kw'>=</span> <span class='fu'>list</span>())</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>..., data</th>
      <td><p>Named values. These dots support <a href='tidy-dots.html'>tidy
dots</a> features.</p></td>
    </tr>
    <tr>
      <th>.parent</th>
      <td><p>A parent environment. Can be an object supported by
<code><a href='as_environment.html'>as_environment()</a></code>.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="environments-as-objects"><a class="anchor" href="#environments-as-objects"></a>Environments as objects</h2>

    
    <p>Environments are containers of uniquely named objects. Their most
common use is to provide a scope for the evaluation of R
expressions. Not all languages have first class environments,
i.e. can manipulate scope as regular objects. Reification of scope
is one of the most powerful feature of R as it allows you to change
what objects a function or expression sees when it is evaluated.</p>
<p>Environments also constitute a data structure in their own
right. They are a collection of uniquely named objects, subsettable
by name and modifiable by reference. This latter property (see
section on reference semantics) is especially useful for creating
mutable OO systems (cf the <a href='https://github.com/wch/R6'>R6 package</a>
and the <a href='http://ggplot2.tidyverse.org/articles/extending-ggplot2.html'>ggprotosystem</a>
for extending ggplot2).</p>
    
    <h2 class="hasAnchor" id="inheritance"><a class="anchor" href="#inheritance"></a>Inheritance</h2>

    
    <p>All R environments (except the <a href='empty_env.html'>empty environment</a>) are
defined with a parent environment. An environment and its
grandparents thus form a linear hierarchy that is the basis for
<a href='https://en.wikipedia.org/wiki/Scope_(computer_science)'>lexicalscoping</a> in
R. When R evaluates an expression, it looks up symbols in a given
environment. If it cannot find these symbols there, it keeps
looking them up in parent environments. This way, objects defined
in child environments have precedence over objects defined in
parent environments.</p>
<p>The ability of overriding specific definitions is used in the
tidyeval framework to create powerful domain-specific grammars. A
common use of masking is to put data frame columns in scope. See
for example <code><a href='as_data_mask.html'>as_data_mask()</a></code>.</p>
    
    <h2 class="hasAnchor" id="reference-semantics"><a class="anchor" href="#reference-semantics"></a>Reference semantics</h2>

    
    <p>Unlike regular objects such as vectors, environments are an
<a href='is_copyable.html'>uncopyable</a> object type. This means that if you
have multiple references to a given environment (by assigning the
environment to another symbol with <code>&lt;-</code> or passing the environment
as argument to a function), modifying the bindings of one of those
references changes all other references as well.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><code>scoped_env</code>, <code><a href='env_has.html'>env_has()</a></code>, <code><a href='env_bind.html'>env_bind()</a></code>.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># env() creates a new environment which has the current environment</span>
<span class='co'># as parent</span>
<span class='no'>env</span> <span class='kw'>&lt;-</span> <span class='fu'>env</span>(<span class='kw'>a</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>b</span> <span class='kw'>=</span> <span class='st'>"foo"</span>)
<span class='no'>env</span>$<span class='no'>b</span></div><div class='output co'>#&gt; [1] "foo"</div><div class='input'><span class='fu'>identical</span>(<span class='fu'><a href='env_parent.html'>env_parent</a></span>(<span class='no'>env</span>), <span class='fu'><a href='get_env.html'>get_env</a></span>())</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>

<span class='co'># child_env() lets you specify a parent:</span>
<span class='no'>child</span> <span class='kw'>&lt;-</span> <span class='fu'>child_env</span>(<span class='no'>env</span>, <span class='kw'>c</span> <span class='kw'>=</span> <span class='st'>"bar"</span>)
<span class='fu'>identical</span>(<span class='fu'><a href='env_parent.html'>env_parent</a></span>(<span class='no'>child</span>), <span class='no'>env</span>)</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='co'># This child environment owns `c` but inherits `a` and `b` from `env`:</span>
<span class='fu'><a href='env_has.html'>env_has</a></span>(<span class='no'>child</span>, <span class='fu'>c</span>(<span class='st'>"a"</span>, <span class='st'>"b"</span>, <span class='st'>"c"</span>, <span class='st'>"d"</span>))</div><div class='output co'>#&gt; [1] FALSE FALSE  TRUE FALSE</div><div class='input'><span class='fu'><a href='env_has.html'>env_has</a></span>(<span class='no'>child</span>, <span class='fu'>c</span>(<span class='st'>"a"</span>, <span class='st'>"b"</span>, <span class='st'>"c"</span>, <span class='st'>"d"</span>), <span class='kw'>inherit</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; [1]  TRUE  TRUE  TRUE FALSE</div><div class='input'>
<span class='co'># `parent` is passed to as_environment() to provide handy</span>
<span class='co'># shortcuts. Pass a string to create a child of a package</span>
<span class='co'># environment:</span>
<span class='fu'>child_env</span>(<span class='st'>"rlang"</span>)</div><div class='output co'>#&gt; &lt;environment: 0x7f828d30f068&gt;</div><div class='input'><span class='fu'><a href='env_parent.html'>env_parent</a></span>(<span class='fu'>child_env</span>(<span class='st'>"rlang"</span>))</div><div class='output co'>#&gt; &lt;environment: package:rlang&gt;
#&gt; attr(,"name")
#&gt; [1] "package:rlang"
#&gt; attr(,"path")
#&gt; [1] "/Users/lionel/Dropbox/Projects/R/hadley/rlang"</div><div class='input'>
<span class='co'># Or `NULL` to create a child of the empty environment:</span>
<span class='fu'>child_env</span>(<span class='kw'>NULL</span>)</div><div class='output co'>#&gt; &lt;environment: 0x7f8292356678&gt;</div><div class='input'><span class='fu'><a href='env_parent.html'>env_parent</a></span>(<span class='fu'>child_env</span>(<span class='kw'>NULL</span>))</div><div class='output co'>#&gt; &lt;environment: R_EmptyEnv&gt;</div><div class='input'>
<span class='co'># The base package environment is often a good default choice for a</span>
<span class='co'># parent environment because it contains all standard base</span>
<span class='co'># functions. Also note that it will never inherit from other loaded</span>
<span class='co'># package environments since R keeps the base package at the tail</span>
<span class='co'># of the search path:</span>
<span class='no'>base_child</span> <span class='kw'>&lt;-</span> <span class='fu'>child_env</span>(<span class='st'>"base"</span>)
<span class='fu'><a href='env_has.html'>env_has</a></span>(<span class='no'>base_child</span>, <span class='fu'>c</span>(<span class='st'>"lapply"</span>, <span class='st'>"("</span>), <span class='kw'>inherit</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; [1] TRUE TRUE</div><div class='input'>
<span class='co'># On the other hand, a child of the empty environment doesn't even</span>
<span class='co'># see a definition for `(`</span>
<span class='no'>empty_child</span> <span class='kw'>&lt;-</span> <span class='fu'>child_env</span>(<span class='kw'>NULL</span>)
<span class='fu'><a href='env_has.html'>env_has</a></span>(<span class='no'>empty_child</span>, <span class='fu'>c</span>(<span class='st'>"lapply"</span>, <span class='st'>"("</span>), <span class='kw'>inherit</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt; [1] FALSE FALSE</div><div class='input'>
<span class='co'># Note that all other package environments inherit from base_env()</span>
<span class='co'># as well:</span>
<span class='no'>rlang_child</span> <span class='kw'>&lt;-</span> <span class='fu'>child_env</span>(<span class='st'>"rlang"</span>)
<span class='fu'><a href='env_has.html'>env_has</a></span>(<span class='no'>rlang_child</span>, <span class='st'>"env"</span>, <span class='kw'>inherit</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)     <span class='co'># rlang function</span></div><div class='output co'>#&gt; [1] TRUE</div><div class='input'><span class='fu'><a href='env_has.html'>env_has</a></span>(<span class='no'>rlang_child</span>, <span class='st'>"lapply"</span>, <span class='kw'>inherit</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)  <span class='co'># base function</span></div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>

<span class='co'># Both env() and child_env() support tidy dots features:</span>
<span class='no'>objs</span> <span class='kw'>&lt;-</span> <span class='fu'>list</span>(<span class='kw'>b</span> <span class='kw'>=</span> <span class='st'>"foo"</span>, <span class='kw'>c</span> <span class='kw'>=</span> <span class='st'>"bar"</span>)
<span class='no'>env</span> <span class='kw'>&lt;-</span> <span class='fu'>env</span>(<span class='kw'>a</span> <span class='kw'>=</span> <span class='fl'>1</span>, !!! <span class='no'>objs</span>)
<span class='no'>env</span>$<span class='no'>c</span></div><div class='output co'>#&gt; [1] "bar"</div><div class='input'>
<span class='co'># You can also unquote names with the definition operator `:=`</span>
<span class='no'>var</span> <span class='kw'>&lt;-</span> <span class='st'>"a"</span>
<span class='no'>env</span> <span class='kw'>&lt;-</span> <span class='fu'>env</span>(!!<span class='no'>var</span> <span class='kw'>:=</span> <span class='st'>"A"</span>)
<span class='no'>env</span>$<span class='no'>a</span></div><div class='output co'>#&gt; [1] "A"</div><div class='input'>

<span class='co'># Use new_environment() to create containers with the empty</span>
<span class='co'># environment as parent:</span>
<span class='no'>env</span> <span class='kw'>&lt;-</span> <span class='fu'>new_environment</span>()
<span class='fu'><a href='env_parent.html'>env_parent</a></span>(<span class='no'>env</span>)</div><div class='output co'>#&gt; &lt;environment: R_EmptyEnv&gt;</div><div class='input'>
<span class='co'># Like other new_ constructors, it takes an object rather than dots:</span>
<span class='fu'>new_environment</span>(<span class='fu'>list</span>(<span class='kw'>a</span> <span class='kw'>=</span> <span class='st'>"foo"</span>, <span class='kw'>b</span> <span class='kw'>=</span> <span class='st'>"bar"</span>))</div><div class='output co'>#&gt; &lt;environment: 0x7f8293e40678&gt;</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#environments-as-objects">Environments as objects</a></li>

      <li><a href="#inheritance">Inheritance</a></li>

      <li><a href="#reference-semantics">Reference semantics</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Lionel Henry, <a href='http://hadley.nz'>Hadley Wickham</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
